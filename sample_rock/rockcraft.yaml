name: flask-app
summary: A flask sample app
description: OCI image for the sample flask app
version: "0.1"
base: bare
build-base: ubuntu:22.04
license: Apache-2.0
platforms:
  amd64:

parts:
  flask-user:
    plugin: nil
    overlay-script: |
      mkdir $CRAFT_OVERLAY/etc
      chmod 755 $CRAFT_OVERLAY/etc
      groupadd -R $CRAFT_OVERLAY --gid 2000 flask
      useradd -R $CRAFT_OVERLAY --system --gid 2000 --uid 2000 --home /srv/flask flask
  flask-dependencies:
    stage-packages:
      - python3-dev
    build-packages:
      - build-essential
      - python3-pip
    plugin: nil
    overlay-script: |
      mkdir -p $CRAFT_OVERLAY/usr/lib/python3/dist-packages
      pip install flask gunicorn --target $CRAFT_OVERLAY/usr/lib/python3/dist-packages
  flask-app:
    plugin: dump
    source: .
    organize:
      sample-app: srv/flask
    prime:
      - srv/flask
